## 변수의 생명주기

변수는 생성되고 소멸하는 생성주기가 있다  
변수에 생명 주기가 없다면 한번 선언된 변수는 프로그럄을 종료히지 않는 한 영원히 메모리 공간을 점유하게 된다

### 지역변수의 생명주기

지역변수의 생명주기는 함수의 생명주기와 동일하다

```js
function foo() {
  var x = "local";
  console.log(x); //local
  return x;
}
foo();
```

위 코드의 지역변수 x는 foo 함수가 호출되면 x변수 선언문이 자바스크립트 엔진에 의해 가장 먼저 실행되어 undefined로 초기화 되고 그 뒤에 변수 할당문이 실행되면 x값이 할당된다 그리고 함수가 종료되면 x 변수도 소멸되여 생명주기가 종료된다

하지만 지역변수가 함수보다 오래 생존하는경우도 있다

### 전역변수의 생명주기

var 키워드로 선언한 전역 변수는 전역 객체의 프로퍼티가 된다 이는 전역 변수의 생명주기가 `전역 객체`의 생명주기와 일치 한다는것을 말한다

> 전역객체  
> 전역객체는 코드실행 이전단계에 자바스크립트 엔진에 의해 가장 먼저 생서되는 객체다  
> 전역객체는 빌트인 객체와 환경에따른 호스트 객체 그리고 var 키워드로 선언한 전역변수와 전역 함수를 프로퍼티로 갖는다

<br>

# 전역변수의 문제점

- ### 암묵적 결합

  전역 변수는 모든코드가 전역변수를 참조하고 변경할수 있는 암묵적 결합을 허용한다  
  변수의 유효범위가 크면 클수르고 코드의 가독성은 나빠지고 의도치 않게 상태가 변경될 수 있어서 위험하다

- ### 긴 생명주기

  전역 변수는 생명주가기 길어 메모리 리소스도 오랜기간 소비한다
  var 키워드는 변수의 중복 선언을 허용해 생명주기가 긴 변수는 변수이름이 중복될 가능성이 있다

- ### 스코프 체인 상에서 종점에 존재

  전역변수는 스코프상 종점에 존재하여 변수를 검색할때 전역변수가 가장 마지막에 검색됨으로 전역변수의 검색속도가 가장 느리다

- ### 네임스페이스 오염
  자바스크립트의 가장 큰 문제점 중 하나는 파일이 분리되어 있다 해도 하나의 전역스코프를 공유한다는 것이다 따라서 파일내 동일한 이름으로 명명된 전역변수나 전역함수가 같은 스코프 내에 존재하면 예상치 못한 결과를 가져올 수도 있다

# 전역 변수의 사용을 억제하는 방법

전역변수의 과도한 사용은 위험하다 그러므로 전역변수를 반드시 사용하지 않아도 된다면 지역변수를 사용하는것이 좋다

- ### 즉시 실행 함수
  모든 코드를 즉시실행 함수로 감싸면 모든 변수는 즉시 실행 함수의 지역 변수가 된다

```js
(function () {
  var foo = 10;
})();
```

- ### 네임스페이스 객체
  전역에 네임 스페이스 역할을 담당할 객체를 생성하고 전역변수처럼 사용할 변수를 프로퍼티로 추가하는 방법이다  
  이를 통해 식별자 충돌은 해결할수 있지만 네임스페이스 자체가 전역변수가 되므로 유용하진 않다

```js
var MyApp = {};

MyApp.name = "Lee";
```

- ### 모듈패턴
  모듈 패턴은 클래스를 모방해서 관련이 있는 변수와 함수를 모아 즉시 실행 함수로 감싸 하나의 모듈을 만든다  
  모듈 패턴은 자바스크립트의 강력한 클로저를 기반으로 동작한다  
  이러한 모듈패턴은 전역네임스페이스의 오염을 막는 기능은 한정적이지만 정보은닉을 구현하기위해 사용한다

```js
var Count = (function () {
  //private변수
  var num = 0;

  //외부로 공개할 데이터나 메서드를 프로퍼티로 추가한 객체를 반환한다
  return {
    increase() {
      return ++num;
    },
    decrease() {
      return --num;
    },
  };
})();

//private 변수는 외부로 노출 X
console.log(Counter.num); //undefined
console.log(Coutner.increase()); //1
console.log(Counter.increase()); //2
console.log(Coutner.decrease()); //1
```

위 예제의 즉시실행함수는 객체를 반환한다  
이 겍체에는 외부에 노출하고 싶은 변수느 함수를 감아 반환한다  
반혼되는 객체의 프로퍼티는 퍼블릭 멤버이고 반환하는 객체에 추가히자 않으면 외부에서 접근할수 없는 프라이빗 멤버가 된다

- ### ES6 모듈

`ES6 모듈은 파일 자체의 독자적인 모듈 스코프를 제공한다` Es6 모듈을 사용하면 더는 전역 변수를 사용할수 없다  
사용방법은 script 태그에 `type="module"` 어트리 뷰트를 추가하면 끝이고 모듈의 파일확장자는 mjs를 권장한다

```js
<script type="module" src="lib.mjs"></script>
```

하지만 ES6 모듈기능을 사용하더라도 트랜스파일링이나 번들링이 필요하기 때문에 Webpack등 모듈번들러를 사용한다
